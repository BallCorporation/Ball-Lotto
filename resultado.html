<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resultado do Sorteio</title>

<style>
:root {
  --blue1: #0038a8;
  --blue2: #0f4fdc;
  --blue3: #4f8dff;
  --white: #ffffff;
}

/* FULL SCREEN */
body {
  margin: 0;
  padding: 0;
  background: #000814;
  color: white;
  height: 100vh;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 20px;
}

#arena {
  width: 100%;
  max-width: 900px;
  height: 300px;
  background: #001226;
  border-radius: 16px;
  border: 1px solid #2a3b5f;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  overflow: hidden;
}

/* BOT√ïES */
.btn {
  padding: 12px 26px;
  border-radius: 10px;
  border: 2px solid #0f4fdc;
  background: white;
  color: #0f4fdc;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  display: none;
  margin: 5px;
  transition: 0.2s;
}

.btn:hover {
  background: #dbe8ff;
}

/* LAYOUT DOS BOT√ïES */
#botoes {
  display: flex;
  gap: 12px;
  justify-content: center;
}

/* LATA FINAL */
.final-can {
  position: relative;
  width: 90px;
  height: 150px;
  border-radius: 30px;
  margin: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 2rem;
  font-weight: bold;
  color: var(--white);
  animation: pop 0.4s ease-out forwards;
  background-image: linear-gradient(90deg,
    var(--blue1) 0%, var(--blue2) 35%, var(--blue3) 60%, var(--blue2) 85%, var(--blue1) 100%);
}

/* TAMPA SUPERIOR */
.final-can::before {
  content: "";
  position: absolute;
  left: 10px;
  right: 10px;
  height: 14px;
  border-radius: 999px;
  background: radial-gradient(circle at 50% 0,
    var(--white), #e5e7eb 40%, #9ca3af 70%, #4b5563 100%);
  top: -8px;
}

/* LATA DA ANIMA√á√ÉO */
.spin-can {
  position: absolute;
  width: 65px;
  height: 120px;
  border-radius: 26px;
  opacity: 0;
  font-size: 1.2rem;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  animation: spin 0.3s linear forwards;
  background-image: linear-gradient(90deg,
    var(--blue1) 0%, var(--blue2) 35%, var(--blue3) 60%, var(--blue2) 85%, var(--blue1) 100%);
}

.spin-can::before {
  content: "";
  position: absolute;
  left: 8px;
  right: 8px;
  height: 12px;
  border-radius: 999px;
  background: radial-gradient(circle at 50% 0,
    var(--white), #e5e7eb 40%, #9ca3af 70%, #4b5563 100%);
  top: -6px;
}

/* ANIMA√á√ïES */
@keyframes spin {
  0% { opacity: 0; transform: scale(0.3) rotate(0deg); }
  50% { opacity: 1; transform: scale(1.1) rotate(180deg); }
  100% { opacity: 0; transform: scale(0.3) rotate(360deg); }
}

@keyframes pop {
  from { transform: scale(0.3); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
</style>
</head>

<body>

<div id="arena"></div>

<div id="botoes">
  <button id="retry" class="btn" onclick="sortearDeNovo()">üîÅ Sortear de novo</button>
  <button id="back" class="btn" onclick="voltar()">‚¨Ö Voltar</button>
</div>

<script>
function getParam(id) {
  const url = new URLSearchParams(window.location.search);
  return parseInt(url.get(id));
}

function random(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

/* SOM */
let audioCtx = null;
function tambor() {
  try {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.frequency.value = 120;
    gain.gain.setValueAtTime(0.7, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.20);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.20);
  } catch(e){}
}

/* ANIMA√á√ÉO */
async function animacao(tempo) {
  const arena = document.getElementById("arena");

  const loop = setInterval(() => {
    const lata = document.createElement("div");
    lata.className = "spin-can";
    lata.style.left = random(10, arena.clientWidth - 70) + "px";
    lata.style.top = random(10, arena.clientHeight - 130) + "px";
    lata.textContent = random(1, 99);

    arena.appendChild(lata);
    tambor();

    setTimeout(() => lata.remove(), 260);
  }, 80);

  return new Promise(resolve => {
    setTimeout(() => {
      clearInterval(loop);
      arena.innerHTML = "";
      resolve();
    }, tempo * 1000);
  });
}

/* SORTEIO FINAL */
async function iniciar() {
  const min = getParam("min");
  const max = getParam("max");
  const qtd = getParam("qtd");
  const tempo = getParam("tempo");

  await animacao(tempo);

  const arena = document.getElementById("arena");
  const usados = new Set();
  const nums = [];

  while (nums.length < qtd) {
    const n = random(min, max);
    if (!usados.has(n)) {
      usados.add(n);
      nums.push(n);
    }
  }

  nums.sort((a,b)=>a-b);

  nums.forEach(n => {
    const lata = document.createElement("div");
    lata.className = "final-can";
    lata.textContent = n;
    arena.appendChild(lata);
  });

  document.getElementById("retry").style.display = "block";
  document.getElementById("back").style.display = "block";
}

/* BOT√ÉO SORTEAR DE NOVO */
function sortearDeNovo() {
  const params = window.location.search;
  window.location.href = "resultado.html" + params;
}

/* VOLTAR */
function voltar() {
  window.location.href = "index.html";
}

iniciar();
</script>

</body>
</html>
